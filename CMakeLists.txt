cmake_minimum_required(VERSION 3.6)

set(CMAKE_CXX_STANDARD 14)
#set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fsanitize=address")

set(WITH_MIDI_SEQUENCER OFF CACHE STRING "")
set(WITH_MUS_SUPPORT OFF CACHE STRING "")
set(WITH_XMI_SUPPORT OFF CACHE STRING "")
set(libADLMIDI_STATIC ON CACHE STRING "")
set(libADLMIDI_SHARED OFF CACHE STRING "")
add_subdirectory("thirdparty/libADLMIDI")
target_include_directories(ADLMIDI_static PUBLIC "thirdparty/libADLMIDI/include")

include(FindPkgConfig)
pkg_check_modules(JACK jack)

## Jack version
if(NOT JACK_FOUND)
  message(WARNING "Jack not found. Not building ADL-jack.")
else()
  add_executable(adljack "jackmain.cc")
  target_include_directories(adljack PRIVATE ${JACK_INCLUDE_DIRS})
  link_directories(${JACK_LIBRARY_DIRS})
  target_link_libraries(adljack ADLMIDI_static ${JACK_LIBRARIES})
  install(TARGETS adljack DESTINATION "bin")
endif()

## Cross platform version
pkg_check_modules(RTAUDIO rtaudio)
pkg_check_modules(RTMIDI rtmidi)
if(NOT RTAUDIO_FOUND)
  message(WARNING "RtAudio not found. Not building ADL-rt.")
elseif(NOT RTMIDI_FOUND)
  message(WARNING "RtMidi not found. Not building ADL-rt.")
else()
  add_subdirectory("thirdparty/ring-buffer")
  add_executable(adlrt "rtmain.cc")
  target_include_directories(adlrt PRIVATE ${RTAUDIO_INCLUDE_DIRS} ${RTMIDI_INCLUDE_DIRS})
  link_directories(${RTAUDIO_LIBRARY_DIRS} ${RTMIDI_LIBRARY_DIRS})
  target_link_libraries(adlrt ADLMIDI_static ring_buffer ${RTAUDIO_LIBRARIES} ${RTMIDI_LIBRARIES})
  foreach(flag ${RTAUDIO_CFLAGS} ${RTMIDI_CFLAGS})
    if(flag MATCHES "^-D")
      target_compile_definitions(adlrt PRIVATE "${flag}")
    endif()
  endforeach()
  install(TARGETS adlrt DESTINATION "bin")
endif()
